<!-- share_index.html -->
{% extends 'base.html' %}

{% load static %}

{% block title %}市场 - {% endblock %}

{% block head %}
    <link rel="stylesheet" href="{% static 'css/share_index.css'%}"/>
    
{% endblock %}

{% block navbar %}
    <li><a href="{% url 'index' %}">热门</a></li>
    <li><a href="{% url 'market_index' %}">市场</a></li>
    <li><a href="#">讨论</a></li>
    <li class="selected"><a href="{% url 'share_index' %}">网盘</a></li>
{% endblock %}


{% block body %}
    <h2 class="title">最新发布</h2>
<!--     <div class = "goodlist">
        <p>{{i}}</p>
    </div> -->
    <table class="table table-hover" border=1>
        <th>文件类别</th>
        <!-- <th>文件id</th> -->
        <th>发表用户</th>
        <th>文件名</th>
        <th>文件大小</th>
        <th>下载次数</th>
        <th>上传时间</th>
        <th>操作</th>
        <th>评价</th>
        <!-- <th>用户名</th>
        <th>学院类型</th> -->
        {% for file in sharefileList %}
            <tr>
                <!-- 只有college的参数是name -->
                <td>
                    <a href="{% url 'show_coll' file.file_classify %}">{{file.file_classify}}</a>
                </td>
                <td><a href="{% url 'show_user' file.user_id %}">{{ file.user }}</a></td>
                <td><a href="{% url 'show_file' file.id %}">{{ file.file_name }}</a></td>

                {% if file.file_size >　1048576 %}
                    <td>{% widthratio file.file_size 1048576 1 %}M</td>
                {% elif file.file_size >　1024 %}
                    <td>{% widthratio file.file_size 1024 1 %} K</td>
                {% else %}
                    <td>{{ file.file_size }} B</td>
                {% endif %}
                <td>{{file.file_bedown}}</td>
                <td>{{file.create_time}}</td>
                <td>
                    <a href="{%url 'd_files' file.id%}">下载</a>
                    <!-- |<a href="{%url 'del_files' file.id%}">删除</a> -->
                </td>
                <script language="JavaScript" src="../static/js/admire.js"></script>
                <td>
                    

                    <span id="goodSpan" onclick="sendGood()">
                        <img src="../static/img/like_bef.png" style="width: 25px; height: 25px;" id='goodimg'/> 
                    </span>
                    <span id="good" style=display:none></span>
                    [<span id="goodnum"></span>]
                        |
                    <span id="badSpan" onclick="sendBad()">
                        <img src="../static/img/like_bef.png" style="width: 25px; height: 25px; transform: rotate(180deg);" id='badimg'/> 
                    </span>
                    <span id="bad" style=display:none></span>
                    [<span id="badnum"></span>]

                </td>

            </tr>
        {% endfor %}
    
    </table>

{% endblock %}

{% block side-search %}
    <div class="spacer">
        <form action="#" id="search">
            <div class="input-group">
            <input type="text" class="form-control" placeholder="搜索">
                <span class="input-group-btn">
                    <button class="btn btn-default" type="button"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                </span>
            </div>
        </form>
    </div> 
{% endblock %}


{% block side %}
<!-- <a class='btn btn-default sidebtn active'>校园二手</a>
<a class='btn btn-default sidebtn'>付费文档</a> -->

<br>
<form action="{%url 'share_index'%}" method="POST">
{% csrf_token %}
    <!-- <script language="JavaScript" src="../static/js/collegeSearch.js"></script> -->
    <script>   
        function change_1()//主分类改变函数
        {
            obj1 = document.getElementById("s_1");
            str1 = obj1.value;
            obj2 = document.getElementById("s_2"); 
            nongkecolleges = {{nongkes|safe}}
            gongkecolleges = {{gongkes|safe}}
            likecolleges = {{likes|safe}}
            wenkecolleges = {{wenkes|safe}}
            if(str1=="农科")
                createSelect(nongkecolleges)
            else if(str1=="工科")
                createSelect(gongkecolleges)
            else if(str1=="理科")
                createSelect(likecolleges)
            else if(str1=="文科")
                createSelect(wenkecolleges)
        }

        function createSelect(colleges)
        {
            obj2.innerHTML = ""; //删除
            colleges.forEach(function(college)
            {
                op = document.createElement("option");
                //创建option元素
                op_text = document.createTextNode(college);
                //创建文本节点
                op.appendChild(op_text);
                //为option添加文本节点
                op.setAttribute("value",college);
                //设置value属性
                obj2.appendChild(op);
                //为obj2添加子节点
            })
        } 
 </script>
    请选择学院类别：
    <select id="s_1" style="width:100px" onchange="change_1();">
        {% for collegetype in collegetypes%}
            <option value="{{collegetype.title}}">{{collegetype.title}}</option>
        {% endfor %}
    </select><br>
    请   选  择   学  院 ： 
    <select id="s_2" style="width:100px" name="selcollege">
    </select>
    <br><input type="submit" value="查询">
</form>
<br>
<br>
<a class='btn btn-info sidebtn' href="{%url 'add_file'%}">添加文件</a>
{% endblock %}